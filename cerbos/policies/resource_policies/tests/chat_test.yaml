# yaml-language-server: $schema=https://api.cerbos.dev/latest/cerbos/policy/v1/TestSuite.schema.json
# docs: https://docs.cerbos.dev/cerbos/latest/policies/compile#testing

name: chatTestSuite
description: Tests for verifying the chat resource policy

principals:
  user#1:
    id: user#1
    roles:
      - user
    attr: {}
  user#2:
    id: user#2
    roles:
      - user
    attr: {}
  admin#2:
    id: admin#2
    roles:
      - admin
    attr: {}
  clerk#3:
    id: clerk#3
    roles:
      - clerk
    attr: {}

resources:
  chat#1:
    id: chat#1
    kind: chat
    attr:
      ownerId: "user#2"


tests:
  - name: chat actions
    input:
      principals:
        - user#1
        - user#2
        - admin#2
        - clerk#3
      resources:
        - chat#1
      actions:
        - create
        - read
        - update
        - delete
    expected:
      - resource: chat#1
        principal: user#1
        actions:
          create: EFFECT_ALLOW
          read: EFFECT_DENY
          update: EFFECT_DENY
          delete: EFFECT_DENY
      - resource: chat#1
        principal: user#2
        actions:
          create: EFFECT_ALLOW
          read: EFFECT_ALLOW
          update: EFFECT_ALLOW
          delete: EFFECT_ALLOW
      - resource: chat#1
        principal: admin#2
        actions:
          create: EFFECT_ALLOW
          read: EFFECT_ALLOW
          update: EFFECT_ALLOW
          delete: EFFECT_ALLOW
      - resource: chat#1
        principal: clerk#3
        actions:
          create: EFFECT_DENY
          read: EFFECT_ALLOW
          update: EFFECT_ALLOW
          delete: EFFECT_ALLOW
